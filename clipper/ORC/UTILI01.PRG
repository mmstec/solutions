
* TITULO     :  MFB Materiais de Construcao Ltda ( MMStec - Orcamento )
* DATA       : 06/03/97
* PROGRAMA   : UTILI01.PRG
* COMENTARIO : INCLUSAO (1 - ICMS)
 
**
** Bloco de inser‡„o I01.B01
**
MENSAGEM("Aguarde abertura de arquivos")
SELE 1
IF .NOT. USEREDE("ICMS",.F.,10)
   BEEP()
   MENSAGEM("O arquivo ICMS n„o est  dispon¡vel",3)
   RETURN
ELSE
   SET INDEX TO
ENDIF
SELE 1
**
** Bloco de inser‡„o I01.B02
**
***
*** Inicio do bloco de substitui‡„o I01.B
COR("MENU")
@ LIN_MENU,00
@ LIN_MENU,01 SAY "Inclus„o ³ 1 - ICMS"
M->P_VERI = .T.
M->X_VERI = .F.
DO WHILE .T.
   **
   ** Bloco de inser‡„o I01.B03
   **
   MENSAGEM("Tecle <ESC> para retornar")
   IF M->P_VERI
      **
      ** Bloco de inser‡„o I01.B04
      **
      CARREG01(1)
   ELSE
      M->X_VERI = .T.
      **
      ** Bloco de inser‡„o I01.B05
      **
   ENDIF
   IF CARGET01(1)=.F.
      EXIT
   ENDIF
   **
   ** Bloco de inser‡„o I01.B10
   **
   IF PERG("Confirma as informa‡”es ?")="N"
      M->P_VERI = .F.
      **
      ** Bloco de inser‡„o I01.B11
      **
      LOOP
   ENDIF
   M->P_VERI = .T.
   M->X_VERI = .F.
   **
   ** Bloco de inser‡„o I01.B12
   **
   IF .NOT. ADIREG(0)
      M->P_VERI=.F.
      MENSAGEM("Inclus„o n„o foi bem sucedida",3)
      MENSAGEM("Tecle <ESC> para retornar")
      LOOP
   ENDIF
   SALVAR01()
   COMMIT
   UNLOCK
ENDDO
RESTSCREEN(LIN_MENU+1,00,23,79,TELA_PRI)
**
** Bloco de inser‡„o I01.B13
**
*** Final do bloco de substitui‡„o I01.B
***
 
FUNCTION IFU01006
M->TOTALFINAC = M->VALOR_UNI-M->DESCONTO+M->FINACEIRO
COR("GETS")
RETURN .T.
 
FUNCTION IFU01009
M->CREDT_ICMS = (M->TOTALFINAC*M->ICMS_7)/100
COR("GETS")
RETURN .T.
 
FUNCTION IFU01011
M->BASE_C_SUB = M->TOTALFINAC*M->BASE_135
COR("GETS")
RETURN .T.
 
FUNCTION IFU01013
M->V_ICMS_SUB = (M->BASE_C_SUB*M->V_ICMS_17)/100
COR("GETS")
RETURN .T.
 
FUNCTION IFU01015
M->SUB_RETIDA = M->V_ICMS_SUB-M->CREDT_ICMS
COR("GETS")
RETURN .T.
 
FUNCTION IFU01016
M->TOTALGERAL = M->SUB_RETIDA+M->TOTALFINAC
COR("GETS")
RETURN .T.
 
FUNCTION CARREG01
PARA R_CAR
**
** Bloco de inser‡„o I01.B14
**
PUBLIC PRODUTO,UNIDADE,VALOR_UNI,DESCONTO,FINACEIRO,TOTALFINAC,BASE_ICMS,ICMS_7,CREDT_ICMS,BASE_135
PUBLIC BASE_C_SUB,V_ICMS_17,V_ICMS_SUB,VT_PRODUTO,SUB_RETIDA,TOTALGERAL
IF M->R_CAR=1
   M->PRODUTO=SPACE( 30)
   M->UNIDADE=0
   M->VALOR_UNI=0
   M->DESCONTO=0
   M->FINACEIRO=0
   M->TOTALFINAC=0
   M->BASE_ICMS=0
   M->ICMS_7=0
   M->CREDT_ICMS=0
   M->BASE_135=0
   M->BASE_C_SUB=0
   M->V_ICMS_17=0
   M->V_ICMS_SUB=0
   M->VT_PRODUTO=0
   M->SUB_RETIDA=0
   M->TOTALGERAL=0
   **
   ** Bloco de inser‡„o I01.B15
   **
ELSE
   M->PRODUTO=PRODUTO
   M->UNIDADE=UNIDADE
   M->VALOR_UNI=VALOR_UNI
   M->DESCONTO=DESCONTO
   M->FINACEIRO=FINACEIRO
   M->TOTALFINAC=TOTALFINAC
   M->BASE_ICMS=BASE_ICMS
   M->ICMS_7=ICMS_7
   M->CREDT_ICMS=CREDT_ICMS
   M->BASE_135=BASE_135
   M->BASE_C_SUB=BASE_C_SUB
   M->V_ICMS_17=V_ICMS_17
   M->V_ICMS_SUB=V_ICMS_SUB
   M->VT_PRODUTO=VT_PRODUTO
   M->SUB_RETIDA=SUB_RETIDA
   M->TOTALGERAL=TOTALGERAL
   **
   ** Bloco de inser‡„o I01.B16
   **
ENDIF
 
FUNCTION CARGET01
PARA R_CAR
**
** Bloco de inser‡„o I01.B17
**
JANELA( 3, 6,22,70,"1 - ICMS")
COR("CERCADURAS")
@  4, 8 TO 21,68
**
** Bloco de inser‡„o I01.B18
**
COR("GETS")
**
** Bloco de inser‡„o I01.B21
**
IF M->X_VERI
   IFU01011()
   IFU01009()
   IFU01015()
   IFU01006()
   IFU01016()
   IFU01013()
ENDIF
@  6,10 SAY "PRODUTO                  :" GET M->PRODUTO PICTURE "@!"
@  7,10 SAY "QUANTIDADE / VOLUME      :" GET M->UNIDADE PICTURE "@Z 99.99"
@  8,10 SAY "VALOR UNITARIO           :" GET M->VALOR_UNI PICTURE "@Z 9,999,999.99"
@  9,10 SAY "DESCONTO                 :" GET M->DESCONTO PICTURE "@Z 9,999,999.99"
@ 10,10 SAY "FINACEIRO                :" GET M->FINACEIRO PICTURE "@Z 9,999,999.99"
@ 11,10 SAY "TOTAL + FINANCEIRO       :" GET M->TOTALFINAC PICTURE "@Z 9,999,999.99" VALID IFU01006()
@ 12,10 SAY "ICMS ( % )               :" GET M->ICMS_7 PICTURE "@Z 9,999,999.99"
@ 13,10 SAY "CREDITO ICMS             :" GET M->CREDT_ICMS PICTURE "@Z 9,999,999.99" VALID IFU01009()
@ 14,10 SAY "BASE VARIAVEL            :" GET M->BASE_135 PICTURE "@Z 9,999,999.99"
@ 15,10 SAY "CAUCULO + SUBSTITUICAO   :" GET M->BASE_C_SUB PICTURE "@Z 9,999,999.99" VALID IFU01011()
@ 16,10 SAY "ICMS ( % )               :" GET M->V_ICMS_17 PICTURE "@Z 9,999,999.99"
@ 17,10 SAY "VALOR DO ICMS SUBSTITUIDO:" GET M->V_ICMS_SUB PICTURE "@Z 9,999,999.99" VALID IFU01013()
@ 18,10 SAY "SUBSTITUICAO RETIDA      :" GET M->SUB_RETIDA PICTURE "@Z 9,999,999.99" VALID IFU01015()
@ 19,10 SAY "TOTAL DE ICMS            :" GET M->TOTALGERAL PICTURE "@Z 9,999,999.99" VALID IFU01016()
**
** Bloco de inser‡„o I01.B24
**
IF M->R_CAR=3 .OR. M->R_CAR=0
   CLEAR GETS
   IF M->R_CAR=0
      RETURN .T.
   ENDIF
   MENSAGEM("Tecle algo para continuar")
   M->R_X=INKEY(0)
   IF M->R_X=27
      RETURN .F.
   ENDIF
ELSE
   SET CURSOR ON
   READ
   SET CURSOR OFF
   IF LASTKEY()=27
      RETURN .F.
   ENDIF
ENDIF
RETURN .T.
 
FUNCTION SALVAR01
**
** Bloco de inser‡„o I01.B27
**
REPLACE PRODUTO WITH M->PRODUTO
REPLACE UNIDADE WITH M->UNIDADE
REPLACE VALOR_UNI WITH M->VALOR_UNI
REPLACE DESCONTO WITH M->DESCONTO
REPLACE FINACEIRO WITH M->FINACEIRO
REPLACE TOTALFINAC WITH M->TOTALFINAC
REPLACE BASE_ICMS WITH M->BASE_ICMS
REPLACE ICMS_7 WITH M->ICMS_7
REPLACE CREDT_ICMS WITH M->CREDT_ICMS
REPLACE BASE_135 WITH M->BASE_135
REPLACE BASE_C_SUB WITH M->BASE_C_SUB
REPLACE V_ICMS_17 WITH M->V_ICMS_17
REPLACE V_ICMS_SUB WITH M->V_ICMS_SUB
REPLACE VT_PRODUTO WITH M->VT_PRODUTO
REPLACE SUB_RETIDA WITH M->SUB_RETIDA
REPLACE TOTALGERAL WITH M->TOTALGERAL
**
** Bloco de inser‡„o I01.B28
**
 
* Final do programa UTILI01.PRG